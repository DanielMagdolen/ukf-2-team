<!DOCTYPE html>
<html lang="sk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
</head>

<body>
    <h1>Admin Dashboard</h1>

    <!-- Zobrazenie chybových a úspešných hlásení (flash správ) -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <ul>
        {% for category, message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}

    <!-- Formulár na filtrovanie -->
    <form method="get" action="{{ url_for('admin_dashboard') }}">
        <label for="student">Vyberte študenta:</label>
        <select name="student_id" id="student">
            <option value="" {% if not selected_student_id %}selected{% endif %}>Všetci študenti</option>
            {% for student in students %}
            <option value="{{ student['_id'] }}" {% if selected_student_id==student['_id'] %}selected{% endif %}>
                {{ student['surname'] }} {{ student['name'] }}
            </option>
            {% endfor %}
        </select>

        <label for="reviewer">Vyberte recenzenta:</label>
        <select name="reviewer_id" id="reviewer">
            <option value="" {% if not selected_reviewer_id %}selected{% endif %}>Všetci recenzenti</option>
            {% for reviewer in reviewers %}
            <option value="{{ reviewer['_id'] }}" {% if selected_reviewer_id==reviewer['_id'] %}selected{% endif %}>
                {{ reviewer['surname'] }} {{ reviewer['name'] }}
            </option>
            {% endfor %}
        </select>

        <button type="submit">Filtruj</button>
    </form>

    <!-- Zobrazenie prác -->
    {% if works %}
    <h3>Práce pridané študentami:</h3>
    <div>
        {% for work in works %}
        <div>
            <p><strong>Konferencia:</strong> {{ work.conference_name }}</p>
            <p><strong>Názov práce:</strong> {{ work.title }}</p>
            <p><strong>Študent:</strong> {{ work.full_name }}</p>
            <p><strong>Recenzent:</strong>
                {% if work.reviewer_name %}
                {{ work.reviewer_name }}
                {% else %}
                Nepriradený
                {% endif %}
            </p>
            <p><strong>Popis:</strong> {{ work.description }}</p>
            <p><strong>Škola:</strong> {{ work.school }}</p>
            <p><strong>Fakulta:</strong> {{ work.faculty }}</p>
            <p><strong>Ročník:</strong> {{ work.year }}</p>
            <p><strong>Posudok:</strong>
                {% if work.review %}
                <a href="{{ url_for('view_review_admin', work_id=work['_id']) }}">Zobraziť posudok</a>
                {% else %}
                Posudok ešte nebol pridaný.
                {% endif %}
            </p>
            <a href="{{ work.file_path }}" target="_blank">Zobraziť súbor</a>

            <!-- Formulár na priradenie recenzenta sa zobrazí iba, ak recenzent ešte nie je priradený -->
            {% if not work.is_assigned %}
            <form method="post" action="{{ url_for('assign_recenzent') }}">
                <input type="hidden" name="work_id" value="{{ work['_id'] }}">
                <label for="reviewer_{{ work['_id'] }}">Vyberte recenzenta:</label>
                <select name="reviewer_id" id="reviewer_{{ work['_id'] }}">
                    {% for reviewer in reviewers %}
                    <option value="{{ reviewer['_id'] }}">{{ reviewer['surname'] }} {{ reviewer['name'] }}</option>
                    {% endfor %}
                </select>
                <button type="submit">Priradiť recenzenta</button>
                <br></br>
            </form>
            {% else %}
            <p><strong>Recenzent už bol priradený k tejto práci.</strong></p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>Žiadne práce neboli pridané.</p>
    {% endif %}

    <a href="{{ url_for('logout') }}">Odhlásiť sa</a>
    <br>
    <a href="{{ url_for('view_conferences') }}">Naspäť</a>
</body>

</html>